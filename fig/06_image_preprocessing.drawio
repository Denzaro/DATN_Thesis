<mxfile host="Electron" agent="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) draw.io/29.2.9 Chrome/140.0.7339.249 Electron/38.7.2 Safari/537.36" version="29.2.9">
  <diagram name="Image Preprocessing Activity Diagram" id="image-preprocessing">
    <mxGraphModel dx="1056" dy="633" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1400" pageHeight="1200" math="0" shadow="0">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="title" parent="1" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=20;fontStyle=1" value="ðŸ–¼ï¸ LÆ°u Äá»“ Hoáº¡t Äá»™ng: Tiá»n Xá»­ LÃ½ áº¢nh&#xa;(Real-ESRGAN Upscale + Split Quadrants)" vertex="1">
          <mxGeometry height="50" width="500" x="350" y="20" as="geometry" />
        </mxCell>
        <mxCell id="start" parent="1" style="ellipse;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="30" width="30" x="575" y="80" as="geometry" />
        </mxCell>
        <mxCell id="input" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12" value="Nháº­n áº£nh Ä‘áº§u vÃ o&#xa;(image_path)" vertex="1">
          <mxGeometry height="50" width="160" x="510" y="130" as="geometry" />
        </mxCell>
        <mxCell id="check_exists" parent="1" style="rhombus;whiteSpace=wrap;html=1;fontSize=12" value="File áº£nh&#xa;tá»“n táº¡i?" vertex="1">
          <mxGeometry height="70" width="140" x="520" y="210" as="geometry" />
        </mxCell>
        <mxCell id="error_file" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11" value="âŒ BÃ¡o lá»—i:&#xa;FileNotFoundError" vertex="1">
          <mxGeometry height="50" width="140" x="760" y="220" as="geometry" />
        </mxCell>
        <mxCell id="read_image" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12" value="ðŸ“– Äá»c áº£nh&#xa;cv2.imread()" vertex="1">
          <mxGeometry height="50" width="140" x="520" y="310" as="geometry" />
        </mxCell>
        <mxCell id="check_valid" parent="1" style="rhombus;whiteSpace=wrap;html=1;fontSize=11" value="áº¢nh há»£p lá»‡?&#xa;(khÃ´ng null/corrupted)" vertex="1">
          <mxGeometry height="70" width="160" x="510" y="390" as="geometry" />
        </mxCell>
        <mxCell id="error_invalid" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11" value="âŒ BÃ¡o lá»—i:&#xa;ValueError (áº£nh lá»—i)" vertex="1">
          <mxGeometry height="50" width="140" x="760" y="395" as="geometry" />
        </mxCell>
        <mxCell id="get_size" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12" value="ðŸ“ Láº¥y kÃ­ch thÆ°á»›c gá»‘c&#xa;(width, height)" vertex="1">
          <mxGeometry height="50" width="160" x="510" y="490" as="geometry" />
        </mxCell>
        <mxCell id="esrgan_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;dashed=1" value="" vertex="1">
          <mxGeometry height="280" width="380" x="80" y="560" as="geometry" />
        </mxCell>
        <mxCell id="esrgan_title" parent="1" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" value="ðŸ–¥ï¸ REAL-ESRGAN UPSCALE" vertex="1">
          <mxGeometry height="25" width="250" x="140" y="570" as="geometry" />
        </mxCell>
        <mxCell id="load_model" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11" value="ðŸ”§ Táº£i model Real-ESRGAN&#xa;(singleton pattern)" vertex="1">
          <mxGeometry height="45" width="180" x="150" y="605" as="geometry" />
        </mxCell>
        <mxCell id="config" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10" value="âš™ï¸ Cáº¥u hÃ¬nh:&#xa;â€¢ scale = 2x&#xa;â€¢ model = &#39;RealESRGAN_x2plus&#39;&#xa;â€¢ device = &#39;cuda&#39;&#xa;â€¢ fp16 = True" vertex="1">
          <mxGeometry height="80" width="180" x="100" y="665" as="geometry" />
        </mxCell>
        <mxCell id="upscale" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12;fontStyle=1" value="ðŸ–¼ï¸ GPU: model.enhance()&#xa;Upscale áº£nh 2x" vertex="1">
          <mxGeometry height="50" width="180" x="150" y="765" as="geometry" />
        </mxCell>
        <mxCell id="check_output" parent="1" style="rhombus;whiteSpace=wrap;html=1;fontSize=11" value="Output há»£p lá»‡?&#xa;(mean &gt; 5)" vertex="1">
          <mxGeometry height="70" width="160" x="510" y="590" as="geometry" />
        </mxCell>
        <mxCell id="fallback" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10" value="âš ï¸ Fallback: FP32&#xa;Thá»­ láº¡i vá»›i Ä‘á»™ chÃ­nh xÃ¡c cao hÆ¡n" vertex="1">
          <mxGeometry height="50" width="180" x="760" y="595" as="geometry" />
        </mxCell>
        <mxCell id="error_upscale" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11" value="âŒ BÃ¡o lá»—i:&#xa;Upscale tháº¥t báº¡i" vertex="1">
          <mxGeometry height="50" width="130" x="1000" y="595" as="geometry" />
        </mxCell>
        <mxCell id="save_upscaled" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12" value="ðŸ’¾ LÆ°u áº£nh Ä‘Ã£ upscale&#xa;cv2.imwrite()" vertex="1">
          <mxGeometry height="50" width="160" x="510" y="700" as="geometry" />
        </mxCell>
        <mxCell id="split_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;dashed=1" value="" vertex="1">
          <mxGeometry height="260" width="380" x="80" y="880" as="geometry" />
        </mxCell>
        <mxCell id="split_title" parent="1" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=14;fontStyle=1;" value="âœ‚ï¸ SPLIT INTO QUADRANTS" vertex="1">
          <mxGeometry height="25" width="250" x="140" y="890" as="geometry" />
        </mxCell>
        <mxCell id="open_upscaled" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=12" value="ðŸ“– Má»Ÿ áº£nh Ä‘Ã£ upscale&#xa;Image.open()" vertex="1">
          <mxGeometry height="45" width="160" x="510" y="790" as="geometry" />
        </mxCell>
        <mxCell id="calc_split" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11" value="ðŸ“ TÃ­nh tá»a Ä‘á»™ chia&#xa;hw = width // 2&#xa;hh = height // 2" vertex="1">
          <mxGeometry height="55" width="180" x="150" y="925" as="geometry" />
        </mxCell>
        <mxCell id="split_image" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10" value="âœ‚ï¸ Chia áº£nh thÃ nh 4 pháº§n:&#xa;â€¢ Q1: Top-Left (0, 0, hw, hh)&#xa;â€¢ Q2: Top-Right (hw, 0, w, hh)&#xa;â€¢ Q3: Bottom-Left (0, hh, hw, h)&#xa;â€¢ Q4: Bottom-Right (hw, hh, w, h)" vertex="1">
          <mxGeometry height="90" width="220" x="120" y="1000" as="geometry" />
        </mxCell>
        <mxCell id="save_quads" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=11" value="ðŸ’¾ LÆ°u 4 áº£nh quadrant&#xa;{stem}_q1_tl, {stem}_q2_tr,&#xa;{stem}_q3_bl, {stem}_q4_br" vertex="1">
          <mxGeometry height="60" width="180" x="500" y="895" as="geometry" />
        </mxCell>
        <mxCell id="output_obj" parent="1" style="rounded=1;whiteSpace=wrap;html=1;fontSize=10" value="ðŸ“¦ Tráº£ vá» káº¿t quáº£:&#xa;â€¢ upscaled_path: Ä‘Æ°á»ng dáº«n áº£nh upscale&#xa;â€¢ quadrants: tuple 4 áº£nh quadrant&#xa;â€¢ paths: list Ä‘Æ°á»ng dáº«n 4 file quadrant" vertex="1">
          <mxGeometry height="80" width="220" x="480" y="1000" as="geometry" />
        </mxCell>
        <mxCell id="end_outer" parent="1" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=2" value="" vertex="1">
          <mxGeometry height="40" width="40" x="570" y="1115" as="geometry" />
        </mxCell>
        <mxCell id="end_inner" parent="1" style="ellipse;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="20" width="20" x="580" y="1125" as="geometry" />
        </mxCell>
        <mxCell id="error_end_outer" parent="1" style="ellipse;whiteSpace=wrap;html=1;strokeWidth=2" value="" vertex="1">
          <mxGeometry height="40" width="40" x="1050" y="470" as="geometry" />
        </mxCell>
        <mxCell id="error_end_inner" parent="1" style="ellipse;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="20" width="20" x="1060" y="480" as="geometry" />
        </mxCell>
        <mxCell id="a1" edge="1" parent="1" source="start" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="input">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a2" edge="1" parent="1" source="input" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="check_exists">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a3" edge="1" parent="1" source="check_exists" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#b85450" target="error_file" value="KhÃ´ng">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a4" edge="1" parent="1" source="check_exists" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#82b366" target="read_image" value="CÃ³">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a5" edge="1" parent="1" source="read_image" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="check_valid">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a6" edge="1" parent="1" source="check_valid" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#b85450" target="error_invalid" value="KhÃ´ng">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a7" edge="1" parent="1" source="check_valid" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#82b366" target="get_size" value="CÃ³">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a8" edge="1" parent="1" source="get_size" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="load_model">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="590" y="560" />
              <mxPoint x="450" y="560" />
              <mxPoint x="450" y="628" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a9" edge="1" parent="1" source="load_model" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="config">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a10" edge="1" parent="1" source="config" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="upscale">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a11" edge="1" parent="1" source="upscale" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="check_output">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="480" y="785" />
              <mxPoint x="480" y="625" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a12" edge="1" parent="1" source="check_output" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#d79b00" target="fallback" value="KhÃ´ng há»£p lá»‡">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a13" edge="1" parent="1" source="fallback" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#b85450" target="error_upscale" value="Tháº¥t báº¡i">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a14" edge="1" parent="1" source="fallback" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#82b366;dashed=1" target="upscale" value="Thá»­ láº¡i">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="850" y="680" />
              <mxPoint x="850" y="850" />
              <mxPoint x="240" y="850" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a15" edge="1" parent="1" source="check_output" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;fontColor=#82b366" target="save_upscaled" value="Há»£p lá»‡">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a16" edge="1" parent="1" source="save_upscaled" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="open_upscaled">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a17" edge="1" parent="1" source="open_upscaled" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="calc_split">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="813" />
              <mxPoint x="460" y="953" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a18" edge="1" parent="1" source="calc_split" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="split_image">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a19" edge="1" parent="1" source="split_image" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="save_quads">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="460" y="1045" />
              <mxPoint x="460" y="925" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a20" edge="1" parent="1" source="save_quads" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="output_obj">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a21" edge="1" parent="1" source="output_obj" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2" target="end_outer">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="a22" edge="1" parent="1" source="error_file" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" target="error_end_outer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1070" y="245" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a23" edge="1" parent="1" source="error_invalid" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" target="error_end_outer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1070" y="420" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="a24" edge="1" parent="1" source="error_upscale" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;strokeWidth=2;" target="error_end_outer">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1065" y="560" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="legend_box" parent="1" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=1" value="" vertex="1">
          <mxGeometry height="180" width="200" x="1000" y="750" as="geometry" />
        </mxCell>
        <mxCell id="legend_title" parent="1" style="text;html=1;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=12;fontStyle=1" value="ðŸ“‹ ChÃº thÃ­ch" vertex="1">
          <mxGeometry height="25" width="100" x="1050" y="755" as="geometry" />
        </mxCell>
        <mxCell id="legend_action" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="20" width="30" x="1010" y="785" as="geometry" />
        </mxCell>
        <mxCell id="legend_action_text" parent="1" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" value="HÃ nh Ä‘á»™ng" vertex="1">
          <mxGeometry height="20" width="80" x="1050" y="785" as="geometry" />
        </mxCell>
        <mxCell id="legend_decision" parent="1" style="rhombus;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="25" width="30" x="1010" y="810" as="geometry" />
        </mxCell>
        <mxCell id="legend_decision_text" parent="1" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" value="Quyáº¿t Ä‘á»‹nh" vertex="1">
          <mxGeometry height="20" width="80" x="1050" y="815" as="geometry" />
        </mxCell>
        <mxCell id="legend_gpu" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="20" width="30" x="1010" y="845" as="geometry" />
        </mxCell>
        <mxCell id="legend_gpu_text" parent="1" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" value="GPU Processing" vertex="1">
          <mxGeometry height="20" width="100" x="1050" y="845" as="geometry" />
        </mxCell>
        <mxCell id="legend_error" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="20" width="30" x="1010" y="875" as="geometry" />
        </mxCell>
        <mxCell id="legend_error_text" parent="1" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" value="Lá»—i" vertex="1">
          <mxGeometry height="20" width="80" x="1050" y="875" as="geometry" />
        </mxCell>
        <mxCell id="legend_split" parent="1" style="rounded=1;whiteSpace=wrap;html=1;" value="" vertex="1">
          <mxGeometry height="20" width="30" x="1010" y="905" as="geometry" />
        </mxCell>
        <mxCell id="legend_split_text" parent="1" style="text;html=1;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=10" value="Split Quadrants" vertex="1">
          <mxGeometry height="20" width="100" x="1050" y="905" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
